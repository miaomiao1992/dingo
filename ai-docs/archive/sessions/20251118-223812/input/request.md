Task: Investigate LSP diagnostic source mapping bug. Need root cause, explanation, fix design, and tests.
