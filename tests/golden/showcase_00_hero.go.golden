package main

import (
	"encoding/json"
	"errors"
	"net/http"
)

type User struct {
	ID    int
	Name  string
	Email string
}

// Validation with explicit error returns
func validateEmail(email string) (string, error) {
	if email == "" {
		return "", errors.New("email required")
	}
	return email, nil
}
func fetchUser(id int) (*User, error) {

	if id <= 0 {
		return nil, errors.New("invalid user ID")
	}
	return &User{ID: id, Name: "Alice", Email: "alice@example.com"}, nil
}

// Clean error handling with ? operator
// Notice: Zero manual error checks!
func getUserData(id int, email string) (*User, error) {
	tmp1, err1 := validateEmail(email)

	if err1 != nil {
		return nil, err1
	}
	// dingo:e:1
	var validEmail = tmp1
	tmp2, err2 := fetchUser(id)

	if err2 != nil {
		return nil, err2
	}
	// dingo:e:1
	var user = tmp2

	user.Email = validEmail
	return user, nil
}
func handleGetUser(w http.ResponseWriter, r *http.Request) {
	user, err := getUserData(42, "alice@example.com")
	if err != nil {
		http.Error(w, err.Error(), http.StatusBadRequest)
		return
	}

	json.NewEncoder(w).Encode(user)
}
