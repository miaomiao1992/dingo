package main

// Test: Basic property access with safe navigation operator
// Feature: Safe Navigation (?.) - Property Chains
// Complexity: basic

type UserOption_Tag int

const (
	UserOption_Tag_Some UserOption_Tag = iota
	UserOption_Tag_None
)

type UserOption struct {
	tag  UserOption_Tag
	some *User
}

func UserOption_Some(value User) UserOption {
	return UserOption{tag: UserOption_Tag_Some, some: &value}
}

func UserOption_None() UserOption {
	return UserOption{tag: UserOption_Tag_None, some: nil}
}

func (o UserOption) IsSome() bool {
	return o.tag == UserOption_Tag_Some
}

func (o UserOption) IsNone() bool {
	return o.tag == UserOption_Tag_None
}

func (o UserOption) Unwrap() User {
	if o.IsNone() {
		panic("called Unwrap on None")
	}
	return *o.some
}

type AddressOption_Tag int

const (
	AddressOption_Tag_Some AddressOption_Tag = iota
	AddressOption_Tag_None
)

type AddressOption struct {
	tag  AddressOption_Tag
	some *Address
}

func AddressOption_Some(value Address) AddressOption {
	return AddressOption{tag: AddressOption_Tag_Some, some: &value}
}

func AddressOption_None() AddressOption {
	return AddressOption{tag: AddressOption_Tag_None, some: nil}
}

func (o AddressOption) IsSome() bool {
	return o.tag == AddressOption_Tag_Some
}

func (o AddressOption) IsNone() bool {
	return o.tag == AddressOption_Tag_None
}

func (o AddressOption) Unwrap() Address {
	if o.IsNone() {
		panic("called Unwrap on None")
	}
	return *o.some
}

type User struct {
	name    string
	address AddressOption
}

type Address struct {
	city string
}

func getUser(id int) UserOption {
	if id > 0 {
		addr := AddressOption_Some(Address{city: "Boston"})
		return UserOption_Some(User{name: "Alice", address: addr})
	}
	return UserOption_None()
}

func main() {
	user := getUser(1)
	// Basic property chain: user?.address?.city
	city := func() string {
		if user.IsNone() {
			return ""
		}
		_user := user.Unwrap()

		if _user.address.IsNone() {
			return ""
		}
		_address := _user.address.Unwrap()

		return _address.city
	}()
	println(city)
}
