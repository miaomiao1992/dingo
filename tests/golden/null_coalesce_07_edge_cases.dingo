package main

// Test: Null coalescing edge cases and special scenarios
// Feature: ?? operator edge cases
// Complexity: advanced

enum StringOption {
	Some(string),
	None,
}

enum BoolOption {
	Some(bool),
	None,
}

func main() {
	// Test 1: Empty string as fallback
	let name: StringOption = StringOptionSome("")
	let display = name ?? "Default"  // Should return ""

	// Test 2: Zero value as fallback
	let zero: BoolOption = BoolOptionSome(false)
	let result = zero ?? true  // Should return false

	// Test 3: Nested null coalesce (separate into two steps to avoid parser complexity)
	let opt1: StringOption = StringOptionNone()
	let opt2: StringOption = StringOptionSome("Found")
	let intermediate = opt1 ?? opt2
	let combined = intermediate ?? "Fallback"

	// Test 4: ?? in boolean context
	let flag: BoolOption = BoolOptionNone()
	let enabled = flag ?? false

	// Test 5: Multiple ?? in same expression (different vars)
	let first: StringOption = StringOptionNone()
	let second: StringOption = StringOptionNone()
	let a = first ?? "A"
	let b = second ?? "B"
	let concat = a + b

	// Test 6: ?? with method chain (separate ?. and ??)
	let text: StringOption = StringOptionSome("hello")
	let upperOpt = text?.toUpper()
	let upper = upperOpt ?? "DEFAULT"

	println("Display:", display)
	println("Result:", result)
	println("Combined:", combined)
	println("Enabled:", enabled)
	println("Concat:", concat)
	println("Upper:", upper)
}

func (s StringOption) toUpper() StringOption {
	if s.IsNone() {
		return StringOptionNone()
	}
	// Simplified uppercase
	return s
}
