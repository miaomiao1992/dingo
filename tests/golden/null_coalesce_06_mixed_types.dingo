package main

// Test: Null coalescing with mixed Option and pointer types
// Feature: ?? operator with type transitions
// Complexity: advanced

enum UserOption {
	Some(User),
	None,
}

enum StringOption {
	Some(string),
	None,
}

type User struct {
	name    string
	profile *Profile
}

type Profile struct {
	bio string
}

func main() {
	// Test 1: Option -> pointer transition (separate ?. and ??)
	let user: UserOption = getUser()
	let profileOpt = user?.profile
	let bioOpt = profileOpt?.bio
	let bio = bioOpt ?? "No bio"

	// Test 2: Pointer -> Option transition (separate ?. and ??)
	let userPtr: *User = getUserPtr()
	let nameOpt = userPtr?.name
	let name = nameOpt ?? "Anonymous"

	// Test 3: Mixed chain with multiple types (separate ?. and ??)
	let user2: UserOption = UserOptionSome(User{
		name:    "Bob",
		profile: &Profile{bio: "Engineer"},
	})
	let profileOpt2 = user2?.profile
	let bioOpt2 = profileOpt2?.bio
	let profile = bioOpt2 ?? "Default bio"

	// Test 4: Option method returning pointer (separate ?. and ??)
	let user3: UserOption = getUser()
	let emailOpt = user3?.getEmail()
	let email = emailOpt ?? "no-email"

	println("Bio:", bio)
	println("Name:", name)
	println("Profile:", profile)
	println("Email:", email)
}

func getUser() UserOption {
	return UserOptionNone()
}

func getUserPtr() *User {
	return nil
}

func (u User) getEmail() *string {
	email := u.name + "@example.com"
	return &email
}
