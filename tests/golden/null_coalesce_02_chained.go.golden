package main

// Test: Chained null coalescing (single IIFE optimization)
// Feature: Null coalescing with multiple fallbacks
// Complexity: intermediate

type StringOptionTag uint8

const (
	StringOptionTagSome StringOptionTag = iota
	StringOptionTagNone
)

type StringOption struct {
	tag  StringOptionTag
	some *string
}

func StringOption_Some(arg0 string) StringOption {
	return StringOption{tag: StringOptionTagSome, some: &arg0}
}
func StringOption_None() StringOption {
	return StringOption{tag: StringOptionTagNone}
}
func (e StringOption) IsSome() bool {
	return e.tag == StringOptionTagSome
}
func (e StringOption) IsNone() bool {
	return e.tag == StringOptionTagNone
}
func main() {
	// Test 1: Chain of Option values (a ?? b ?? c)
	var firstName StringOption = StringOption_None()
	var middleName StringOption = StringOption_None()
	var lastName StringOption = StringOption_Some("Smith")

	// Chained null coalescing - try each in order
	var name string
	if firstName.IsSome() {
		name = *firstName.some
	} else if middleName.IsSome() {
		name = *middleName.some
	} else if lastName.IsSome() {
		name = *lastName.some
	} else {
		name = "Unknown"
	}

	// Test 2: Chain with function calls
	primary := getConfig("primary")
	fallback := getConfig("fallback")
	var config string
	if primary.IsSome() {
		config = *primary.some
	} else if fallback.IsSome() {
		config = *fallback.some
	} else {
		config = "default"
	}

	// Test 3: Long chain
	var opt1 StringOption = StringOption_None()
	var opt2 StringOption = StringOption_None()
	var opt3 StringOption = StringOption_None()
	var opt4 StringOption = StringOption_Some("Found")
	var result string
	if opt1.IsSome() {
		result = *opt1.some
	} else if opt2.IsSome() {
		result = *opt2.some
	} else if opt3.IsSome() {
		result = *opt3.some
	} else if opt4.IsSome() {
		result = *opt4.some
	} else {
		result = "Not Found"
	}

	println("Name:", name)
	println("Config:", config)
	println("Result:", result)
}
func getConfig(key string) StringOption {
	if key == "fallback" {
		return StringOption_Some("backup-value")
	}
	return StringOption_None()
}
