package main

// Test: Null coalescing with mixed Option and pointer types
// Feature: ?? operator with type transitions
// Complexity: advanced

type UserOptionTag uint8

const (
	UserOptionTagSome UserOptionTag = iota
	UserOptionTagNone
)

type UserOption struct {
	tag  UserOptionTag
	some *User
}

func UserOption_Some(arg0 User) UserOption {
	return UserOption{tag: UserOptionTagSome, some: &arg0}
}
func UserOption_None() UserOption {
	return UserOption{tag: UserOptionTagNone}
}
func (e UserOption) IsSome() bool {
	return e.tag == UserOptionTagSome
}
func (e UserOption) IsNone() bool {
	return e.tag == UserOptionTagNone
}

type StringOptionTag uint8

const (
	StringOptionTagSome StringOptionTag = iota
	StringOptionTagNone
)

type StringOption struct {
	tag  StringOptionTag
	some *string
}

func StringOption_Some(arg0 string) StringOption {
	return StringOption{tag: StringOptionTagSome, some: &arg0}
}
func StringOption_None() StringOption {
	return StringOption{tag: StringOptionTagNone}
}
func (e StringOption) IsSome() bool {
	return e.tag == StringOptionTagSome
}
func (e StringOption) IsNone() bool {
	return e.tag == StringOptionTagNone
}

type User struct {
	name    string
	profile *Profile
}

type Profile struct {
	bio string
}

func main() {
	// Test 1: Option -> pointer transition
	var user UserOption = getUser()
	var bio = func() string {
		__safeNav := func() string {
			if user.IsNone() {
				return ""
			}
			_user := *user.some

			if _user.profile == nil {
				return ""
			}

			return _user.profile.bio
		}()
		if __safeNav != "" {
			return __safeNav
		}
		return "No bio"
	}()

	// Test 2: Pointer -> Option transition
	var userPtr *User = getUserPtr()
	var name = func() string {
		__safeNav := func() string {
			if userPtr == nil {
				return ""
			}
			return userPtr.name
		}()
		if __safeNav != "" {
			return __safeNav
		}
		return "Anonymous"
	}()

	// Test 3: Mixed chain with multiple types
	var user2 UserOption = UserOption_Some(User{
		name:    "Bob",
		profile: &Profile{bio: "Engineer"},
	})
	var profile = func() string {
		__safeNav := func() string {
			if user2.IsNone() {
				return ""
			}
			_user := *user2.some

			if _user.profile == nil {
				return ""
			}

			return _user.profile.bio
		}()
		if __safeNav != "" {
			return __safeNav
		}
		return "Default bio"
	}()

	// Test 4: Option method returning pointer
	var user3 UserOption = getUser()
	var email = func() string {
		__safeNav := func() *string {
			if user3.IsNone() {
				return nil
			}
			_user := *user3.some
			return _user.getEmail()
		}()
		if __safeNav != nil {
			return *__safeNav
		}
		return "no-email"
	}()

	println("Bio:", bio)
	println("Name:", name)
	println("Profile:", profile)
	println("Email:", email)
}

func getUser() UserOption {
	return UserOption_None()
}

func getUserPtr() *User {
	return nil
}

func (u User) getEmail() *string {
	email := u.name + "@example.com"
	return &email
}
