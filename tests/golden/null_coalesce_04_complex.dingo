package main

// Test: Complex null coalescing expressions
// Feature: ?? operator with nested expressions and function calls
// Complexity: advanced

enum StringOption {
	Some(string),
	None,
}

enum IntOption {
	Some(int),
	None,
}

enum ConfigOption {
	Some(Config),
	None,
}

type Config struct {
	host string
	port int
}

func main() {
	// Test 1: Function call on right side
	let name: StringOption = StringOptionNone()
	let display = name ?? getDefaultName()

	// Test 2: Nested ?? in expressions
	let port: IntOption = IntOptionNone()
	let finalPort = (port ?? 8080) + 1000

	// Test 3: ?? with expressions on both sides (separate ?. and ??)
	let config: ConfigOption = getConfig()
	let hostOpt = config?.host
	let host = hostOpt ?? getEnv("HOST") ?? "localhost"

	// Test 4: Complex chaining with method calls (separate ?. and ??)
	let user: StringOption = findUser(42)
	let userUpper = user?.toUpper()
	let username = userUpper ?? getGuestName() ?? "GUEST"

	// Test 5: Nested function calls
	let timeout: IntOption = IntOptionNone()
	let finalTimeout = timeout ?? parseEnv("TIMEOUT") ?? getDefaultTimeout()

	// Test 6: Mixed with arithmetic
	let count: IntOption = IntOptionNone()
	let total = (count ?? 10) * 2

	println("Display:", display)
	println("Port:", finalPort)
	println("Host:", host)
	println("Username:", username)
	println("Timeout:", finalTimeout)
	println("Total:", total)
}

func getDefaultName() string {
	return "Unknown User"
}

func getEnv(key string) StringOption {
	if key == "HOST" {
		return StringOptionSome("example.com")
	}
	return StringOptionNone()
}

func getConfig() ConfigOption {
	return ConfigOptionNone()
}

func findUser(id int) StringOption {
	return StringOptionNone()
}

func (s StringOption) toUpper() StringOption {
	if s.IsNone() {
		return StringOptionNone()
	}
	// Simplified - just return the same for demo
	return s
}

func getGuestName() StringOption {
	return StringOptionNone()
}

func parseEnv(key string) IntOption {
	return IntOptionNone()
}

func getDefaultTimeout() int {
	return 30
}
