package main

// Test: Null coalescing with Go raw pointers
// Feature: ?? operator with pointer types
// Complexity: intermediate

type User struct {
	name string
	age  int
}

func main() {
	// Test 1: Pointer ?? literal
	var user *User = getUser(1)
	var name = func() string {
		__safeNav := func() string {
			if user == nil {
				return ""
			}
			return user.name
		}()
		if __safeNav != "" {
			return __safeNav
		}
		return "Unknown"
	}()

	// Test 2: Pointer ?? pointer
	var primary *string = getPrimary()
	var fallback *string = getFallback()
	var result = func() string {
		if primary != nil {
			return *primary
		}
		if fallback != nil {
			return *fallback
		}
		return ""
	}()

	// Test 3: Nested pointer access
	var userPtr *User = getUser(2)
	var age = func() int {
		__safeNav := func() int {
			if userPtr == nil {
				return 0
			}
			return userPtr.age
		}()
		if __safeNav != 0 {
			return __safeNav
		}
		return 0
	}()

	// Test 4: Nil pointer handling
	var nilUser *User = nil
	var nilName = func() string {
		__safeNav := func() string {
			if nilUser == nil {
				return ""
			}
			return nilUser.name
		}()
		if __safeNav != "" {
			return __safeNav
		}
		return "Default"
	}()

	println("Name:", name)
	println("Age:", age)
	println("Nil:", nilName)
}

func getUser(id int) *User {
	if id == 1 {
		return &User{name: "Alice", age: 30}
	}
	return nil
}

func getPrimary() *string {
	return nil
}

func getFallback() *string {
	s := "Fallback"
	return &s
}
